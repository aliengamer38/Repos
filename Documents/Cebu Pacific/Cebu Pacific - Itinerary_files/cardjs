(function(n,t){"use strict";t.Class.cardDisplayFormatter=function(){var i=this,r,u;return i.elements=[],i.elementSelector="",r=typeof t.cardUtility=="function"?new t.cardUtility:null,i.onReady=function(){i.initializeObjects();i.formatCreditCards()},i.initializeObjects=function(){i.elementSelector&&(i.elements=n(i.elementSelector))},i.formatCreditCards=function(){var s=i.elements.length,t,o;if(s&&r)for(t=0;t<s;t++){var e=i.elements.eq(t),n=u(e),f=e.html();n&&n.paymentCode&&n.cardNumber&&f.indexOf(n.cardNumber)>0&&(o=r.getCreditCardByType(n.cardNumber,n.paymentCode),o&&(f=f.replace(n.cardNumber,o),e.html(f)))}},u=function(n){if(!n||!n.length)return null;var t=n.data();return t&&t.paymentCode&&t.cardNumber?{paymentCode:t.paymentCode,cardNumber:t.cardNumber}:null},i}})(jQuery,nca),function(n,t){"use strict";var i=window.cardUtility=t.cardUtility=function(){var t=this;t.ccjQuery=[];t.cvvjQuery=[];var h={"0":48,"9":57,NUMPAD_0:96,NUMPAD_9:105,DELETE:46,BACKSPACE:8,ARROW_LEFT:37,ARROW_RIGHT:39,ARROW_UP:38,ARROW_DOWN:40,HOME:36,END:35,TAB:9,A:65,X:88,C:67,V:86},o={paymentName:"Default",paymentTypeCode:"00",cardFormat:[4,4,4,4],cvvFormat:[3],defaultDelimiter:!0,cardNumberLength:16,cvvNumberLength:3},u=[{paymentName:"UATP",paymentTypeCode:"TP",cardFormat:[4,5,6],cvvFormat:[3],defaultDelimiter:!0,reString:/^(?!1800)1\d{0,14}/},{paymentName:"Mastercard",paymentTypeCode:"MC",cardFormat:[4,4,4,4],cvvFormat:[3],defaultDelimiter:!0,reString:/^(5[1-5]\d{0,2}|22[2-9]\d{0,1}|2[3-7]\d{0,2})\d{0,12}/},{paymentName:"Visa",paymentTypeCode:"VI",cardFormat:[4,4,4,4],cvvFormat:[3],defaultDelimiter:!0,reString:/^4\d{0,15}/},{paymentName:"TwoCTwoP",paymentTypeCode:"V2",cardFormat:[4,4,4,4],cvvFormat:[3],defaultDelimiter:!0,reString:/^4\d{0,15}/},{paymentName:"FirstData",paymentTypeCode:"AQ",cardFormat:[4,4,4,4],cvvFormat:[3],defaultDelimiter:!0,reString:/^4\d{0,15}/},{paymentName:"WorldPay",paymentTypeCode:"M2",cardFormat:[4,4,4,4],cvvFormat:[3],defaultDelimiter:!0,reString:/^4\d{0,15}/},{paymentName:"Amex",paymentTypeCode:"AX",cardFormat:[4,6,5],cvvFormat:[4],defaultDelimiter:!0,reString:/^3[47]\d{0,13}/}],i=function(n){return n===undefined||n===null?"":(n=n.toString(),n.replace(/[\s]/g,""))},s=function(n){return n===undefined||n===null?"":(n=n.toString(),n.replace(/[^0-9]/g,""))},f=function(n){var t=typeof n;return t==="string"||t==="number"},p=function(n){var t=typeof n;return t==="string"||t==="number"},b=function(n){return n&&n.originalEvent?n.originalEvent.data:""},k=function(n){return n&&n.originalEvent?n.originalEvent.inputType||"":""},d=function(n){var t=n?n.which||n.keyCode:null,i;if(!t){i=k(n);switch(i){case"deleteContentBackward":t=h.BACKSPACE;break;case"deleteContentForward":t=h.DELETE}}return t},g=function(n){return d(n)===h.DELETE},nt=function(n){return d(n)===h.BACKSPACE},tt=function(n){return k(n)==="deleteByCut"},c=function(n){var t={start:0,end:0};return n&&(t.start=typeof n.selectionStart=="number"&&n.selectionStart>-1?n.selectionStart:n.value.length,t.end=typeof n.selectionEnd=="number"?n.selectionEnd:n.value.length),t},l=function(t,i){var r=n.extend({},{start:0,end:0},i);if(t&&t.length&&t.forEach){var f=0,e=!1,o=!1,u=0;t.forEach(function(n,t){var s=typeof n,i=f,h=t>0?1:0;s==="number"&&(f+=n+h,u+=n);!e&&r.start>=i&&r.start<=f&&(r.start=r.start-t,e=!0);!o&&r.end>=i&&r.end<=f&&(r.end=r.end-t,o=!0)});e||(r.start>u?r.start=u:r.start<0&&(r.start=0));o||(r.end>u?r.end=u:r.end<0&&(r.end=0))}return r},rt=function(n,t){var u,i,r;return!n||t<0?0:(u=n.length,u&&n.forEach&&(i=0,r=!1,n.forEach(function(n,f){var e=typeof n,o=i;e==="number"&&(i+=n);!r&&t>=o&&t<=i&&(t+=f,r=!0);u-1!==f||r||(t=i+f)})),t)},r=function(n,t,i,r){var u,f;n&&(u=r!==!0?t:rt(i,t),n.createTextRange?(f=n.createTextRange(),f.move("character",u),f.select()):n.selectionStart?(n.focus(),n.setSelectionRange(u,u)):n.focus())},a=function(n){var t=0;return!n||!n.length||!n.forEach?t:(n.forEach(function(n){var i=typeof n;i==="number"&&(t+=n)}),t)},e=function(n,t,r){var e,u,o;return!f(n)||!t?n:(e=t.length,!e||!t.forEach)?n:(u="",o=r===!0?" ":"",n=i(n),t.forEach(function(t,i){var s,r,f;n.length>0&&(s=typeof t,s==="number"&&(r=n.slice(0,t),f=n.slice(t),u+=r,f.length||(o=""),r.length===t&&i<e-1&&(u+=o),n=f))}),u)},v=function(t){var i,r;t&&t.target&&(i=n(t.target),i.length&&(r=i.val(),i.data("prevValue",r)))},it=function(t,i){t&&(t=n(t),t.length&&(i=i||t.val(),t.data("prevValue",i)))};t.init=function(i,r,f){if(f&&f.creditCards&&(u=n.extend({},u,f.creditCards)),i&&i.length){t.ccjQuery=i;t.ccjQuery.on("focusin",v);t.ccjQuery.on("paste",ut);t.ccjQuery.on("input",ft);t.ccjQuery.on("formatcc",y);t.ccjQuery.val()&&t.ccjQuery.triggerHandler("formatcc")}if(r&&r.length){t.cvvjQuery=r;t.cvvjQuery.on("focusin",v);t.cvvjQuery.on("paste",et);t.cvvjQuery.on("input",ot);t.cvvjQuery.on("formatcvv",w);t.cvvjQuery.val()&&t.cvvjQuery.triggerHandler("formatcvv")}};var y=function(n,r,u){var o,s;if(t.ccjQuery.length&&(o=t.ccjQuery.val(),o&&f(o))&&(typeof u!="boolean"&&(u=n&&n.data&&n.data.removeNonNumerical),u===!0&&(o=o.replace(/[^\d]/g,"")),o=i(o),s=r?t.getCreditCardInfoByType(r):t.getCreditCardInfo(o),s&&s.cardFormat)){t.ccjQuery.data("cardinfo",s);o=e(o,s.cardFormat,s.defaultDelimiter);t.ccjQuery.val(o);it(t.ccjQuery);return}},ut=function(i){var u;if(i&&(u=i.clipboardData||i.originalEvent?i.originalEvent.clipboardData:null,u&&u.items&&u.items.length)){var e=u.items[0],f=n(i.target),o=t.ccjQuery.length?t.ccjQuery.data("cardinfo"):null;e&&e.kind==="string"&&e.type==="text/plain"&&f.length&&o&&e.getAsString(function(n){var u;if(n&&!f.data("caretset")){var e=f.val(),h=f.get(0),t=n?n.length:0,i=c(f.get(0));e.length>i.start&&(i.start-=t,n=s(n),t=n?n.length:0,u=l(o.cardFormat,i),r(h,u.start+t,o.cardFormat,!0))}})}},ft=function(n){var w=g(n),k=nt(n),ut=w||k||tt(n),p=t.ccjQuery.data("prevValue")||"",h=t.ccjQuery.get(0),f=c(h),ft=t.ccjQuery.val()||"",u=s(i(ft)),a=t.getCreditCardInfo(u),e,o,rt;if(t.ccjQuery.val(u),y(),u=t.ccjQuery.val(),p)if(ut){if(p===u){var d=f.start,it=f.start,et=u.length;w?it+=2:k&&(d-=1,f.start-=1);u=u.slice(0,d)+u.slice(it,et);t.ccjQuery.val(u);y()}r(h,f.start,a.cardFormat,!1)}else e=b(n),o=e?e.length:0,t.ccjQuery.data("caretset",!1),o>0?(p===u?r(h,f.start-o,a.cardFormat,!1):u.length>f.start&&(f.start-=o,e=s(e),o=e?e.length:0,rt=l(a.cardFormat,f),r(h,rt.start+o,a.cardFormat,!0)),t.ccjQuery.data("caretset",!0)):r(h,f.start,a.cardFormat);v(n)};t.formatCreditCardNumber=function(n){if(!f(n))return n;n=i(n);var r=t.getCreditCardInfo(n);return!r||!r.cardFormat?n:e(n,r.cardFormat,r.defaultDelimiter)};t.getCreditCardByFormat=function(n,t,r){return!f(n)||!t||!t.length?n:(n=i(n),e(n,t,r===!0))};t.getCreditCardByType=function(n,r){if(!f(n)||!r)return n;n=i(n);var u=t.getCreditCardInfoByType(r);return u.paymentTypeCode!==r?n:e(n,u.cardFormat,u.defaultDelimiter)};var w=function(n,r){var f,u;if(t.ccjQuery.length&&t.cvvjQuery.length&&(t.ccjQuery.data("cardinfo")||y(),f=t.ccjQuery.data("cardinfo"),f&&f.cvvFormat)&&(u=t.cvvjQuery.val(),u&&p(u))){r===!0&&(u=u.replace(/[^\d]/g,""));u=i(u);u=e(u,f.cvvFormat,f.defaultDelimiter);t.cvvjQuery.val(u);it(t.cvvjQuery);return}},et=function(i){var u;if(i&&(u=i.clipboardData||i.originalEvent?i.originalEvent.clipboardData:null,u&&u.items&&u.items.length)){var e=u.items[0],f=n(i.target),o=t.ccjQuery.length?t.ccjQuery.data("cardinfo"):null;e&&e.kind==="string"&&e.type==="text/plain"&&f.length&&o&&e.getAsString(function(n){var u;if(n&&!f.data("caretset")){var e=f.val(),h=f.get(0),t=n?n.length:0,i=c(f.get(0));e.length>i.start&&(i.start-=t,n=s(n),t=n?n.length:0,u=l(o.cvvFormat,i),r(h,u.start+t,o.cvvFormat,!0))}})}},ot=function(n){var p=g(n),k=nt(n),ut=p||k||tt(n),y=t.cvvjQuery.data("prevValue")||"",h=t.cvvjQuery.get(0),ft=t.cvvjQuery.val(),f=c(h),u=s(i(ft)),et=t.ccjQuery.length?t.ccjQuery.val():"",a=t.getCreditCardInfo(i(et)),e,o,rt;if(t.cvvjQuery.val(u),w(),u=t.cvvjQuery.val(),y)if(ut){if(y===u){var d=f.start,it=f.start,ot=u.length;p?it+=2:k&&(d-=1,f.start-=1);u=u.slice(0,d)+u.slice(it,ot);t.cvvjQuery.val(u);w()}r(h,f.start,a.cvvFormat,!1)}else e=b(n),o=e?e.length:0,t.cvvjQuery.data("caretset",!1),o>0?(y===u?r(h,f.start-o,a.cvvFormat,!1):u.length>f.start&&(f.start-=o,e=s(e),o=e?e.length:0,rt=l(a.cvvFormat,f),r(h,rt.start+o,a.cvvFormat,!0)),t.cvvjQuery.data("caretset",!0)):r(h,f.start,a.cvvFormat);v(n)};return t.formatCvvNumber=function(n,i){if(!p(n)||!f(i))return n;var r=t.getCreditCardInfo(i);return!r||!r.cvvFormat?n:e(n,r.cvvFormat,r.defaultDelimiter)},t.getCvvNumberMasked=function(n,t){return!p(n)||!t||!t.cvvFormat?n:e(n,t.cvvFormat,t.defaultDelimiter)},t.getCreditCardInfo=function(n){var e,r,t,s;if(!u||!f(n)||(e=u.length,!e))return o;for(n=i(n),r=0;r<e;r++)if(t=u[r],s=t.reString,s&&s.test(n))return t.cardNumberLength=a(t.cardFormat),t.cvvNumberLength=a(t.cvvFormat),t;return o},t.getCreditCardInfoByType=function(n){var r,i,t;if(!n||!u||(r=u.length,!r))return o;for(i=0;i<r;i++)if(t=u[i],t.paymentTypeCode===n)return t.cardNumberLength=a(t.cardFormat),t.cvvNumberLength=a(t.cvvFormat),t;return o},t.numbersOnly=function(n){return i(n)},t};n.fn.ccval=function(){var r=n(this),i=r.val();return i&&(i=t.cardUtility?t.cardUtility().numbersOnly(i):i.toString().replace(/[\s]/g,"")),i}}(jQuery,nca)